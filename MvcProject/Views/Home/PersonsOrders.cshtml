@using System.Text.Json
@using Lesson36.Logic
@{
    var personsWithOrdersAndProducts = Ctx.Persons
        .Include(p => p.Orders).ThenInclude(o => o.Products)
        .Include(p => p.Orders).ThenInclude(o => o.OrderDetails)
        .Where(p => p.Orders.Any()).ToList();
    var personsWithOrdersAndProductsSerialized =
        JsonSerializer.Serialize(personsWithOrdersAndProducts, Settings.SerializerOptions).Length;
    var personsWithOrdersAndProducts2 =
        Ctx.Persons
            .Where(p => p.Orders.Any())
            .Select(p => new PersonDto(p.FirstName, p.LastName,
                p.Orders.Select(o =>
                    new OrderDto(o.Info, o.OrderDetails.ShippingAddress,
                        o.Products)).ToList()))
            .ToList();
    var personsWithOrdersAndProductsSerialized2 =
        JsonSerializer.Serialize(personsWithOrdersAndProducts2, Settings.SerializerOptions).Length;
    ViewData["Title"] = "Persons Orders";
}